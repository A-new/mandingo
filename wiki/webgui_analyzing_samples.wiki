#Analyzing samples from the web gui

= Introduction =

After uploading a sample from the web gui we are ready to analyze it (if all it's working ok).

https://mandingo.googlecode.com/svn/trunk/screenshots/sinjector/screenshots/webgui_sample_uploaded.png

Basically, you only have to click in the "Analyze" link after submitting the sample.

= Running the analysis =

When the analysis is running properly:

  * VirtualBox should be started (popup) and the working snapshot you've configured opened.
  * The snapshot should have get network connectivity, and you should read a message like this:
{{{
[info] Trying to connect to remote port (30 seconds max)...
Error(0) - timed out
Error(1) - timed out
Error(2) - timed out
[info] Remote port is open :)
}}}
  * After a while, the sample you want to analyze, should be uploaded to the virtual guest system:
{{{
Uploading sample (md5: 9d8c4d9d189d5220d10223b2089efa60)
Sample uploaded: C:\sinjector/binary4
}}}
  * tcpdump should be launched for the host only interface, and you should not get any error.
  * A initial screenshot should be taken.
  * And you should see the rest of the output of the "sinjector.exe" client -> the API monitored for the sample (malware) you have submitted.

If all it's ok, you should see an output like this:

https://mandingo.googlecode.com/svn/trunk/screenshots/sinjector/screenshots/webgui_log.png

== Some errors ==
=== When python is not located ===

If you have not configured properly the path of the python interpreter binary in "modules/config.php" you'll get an error like this:

{{{
sh: /Library/Frameworks/Python.framework/Versions/2.7/bin/python: No such file or directory
}}}

You can try to locate the current working python binary with:

{{{
$ whereis python
/usr/bin/python
}}}

Then, edit the file "modules/config.php" present with the PHP scripts of the webgui, and replace the variable $python, so you can read this:

{{{
<?php
class Config{
        public static $python="/usr/bin/python";
        ...
}}}
=== When you don't have permissions to run "tcpdump" ===
If you don't have permissions to run "tcpdump", you should read a message like this:
{{{
tcpdump: vboxnet0: You don't have permission to capture on that device
((cannot open BPF device) /dev/bpf0: Permission denied)
}}}
Tip: if you fell safe enabling global suid permissions to "tcpdump", simply run:
{{{
$ sudo chmod a+s /usr/sbin/tcpdump
}}}

=== When "tcpdump" is working, but the interface host only is not in "promiscuous" mode ===

If you get an error like this:

{{{
tcpdump: WARNING: vboxnet0: That device doesn't support promiscuous mode
(BIOCPROMISC: Operation not supported on socket)
}}}

It means that your interface is not configure in "promiscuous" mode.

To enable "promiscuous" mode:

  # Go to VirtualBox
  # Select your guest os (windows xp sp3)
  # Open the configuration
  # Go to Network > Adapter 1 > Advanced
  # And in "promiscuous" mode select "Allow All"

=== Other errors ===

You may get other errors during the analysis, so I'll try to cover them when I have free time here. 

Anyway, if you need some "fast support" don't hesitate to contact me :)