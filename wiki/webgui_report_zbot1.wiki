#report generated for the "zbot" malware sample 353f3b54de9ecfd82c63a2aeaf1c3b9c

= Introduction =

To shown you some of results you can obtain with the "Mandingo's Sandbox", I've downloaded one "zbot" malware sample from "zeustracker" that it's currently alive (C&C on). The MD5 hash for this sample is: 353f3b54de9ecfd82c63a2aeaf1c3b9c

I've found this sample here:

https://zeustracker.abuse.ch/monitor.php?browse=binaries&filter=online

This sample was uploaded from the Web GUI, and was running and monitored during 1 minute, in a virtual guest os "Windows SP SP3 32bit"

= Working from the console =

Before showing you the results in the Web GUI, let's check first what was generated from the console.

The results of the analysis were stored in the folder "sinjector_client/results/353f3b54de9ecfd82c63a2aeaf1c3b9c/"

{{{
$ ls
C:\DOCUME~1\user\LOCALS~1\Temp\agitators.ffw
C:\DOCUME~1\user\LOCALS~1\Temp\nseF.tmp\agitators.dll
C:\DOCUME~1\user\LOCALS~1\Temp\nslD.tmp\agitators.dll
C:\DOCUME~1\user\LOCALS~1\Temp\tmp172d10c8.bat
C:\Documents and Settings\user\Application Data\Microsoft\Address Book\user.wab
C:\Documents and Settings\user\Application Data\Microsoft\CryptnetUrlCache\Content\23B523C9E7746F715D33C6527C18EB9D
C:\Documents and Settings\user\Application Data\Microsoft\CryptnetUrlCache\Content\8A574ED5927B3CEC9626151D220C7448
C:\Documents and Settings\user\Application Data\Microsoft\CryptnetUrlCache\MetaData\23B523C9E7746F715D33C6527C18EB9D
C:\Documents and Settings\user\Application Data\Microsoft\CryptnetUrlCache\MetaData\8A574ED5927B3CEC9626151D220C7448
C:\Documents and Settings\user\Application Data\Nouc\uwutu.idr
C:\Documents and Settings\user\Application Data\Nouc\uwutu.tmp
C:\Documents and Settings\user\Application Data\Vamop\voli.exe
C:\Documents and Settings\user\Cookies\index.dat
C:\Documents and Settings\user\IETldCache\index.dat
C:\Documents and Settings\user\Local Settings\Application Data\Identities\{34C6607A-A5A0-417E-8029-5DCD3B5BAEAF}\Microsoft\Outlook Express\Folders.dbx
C:\Documents and Settings\user\Local Settings\Application Data\Identities\{34C6607A-A5A0-417E-8029-5DCD3B5BAEAF}\Microsoft\Outlook Express\Inbox.dbx
C:\Documents and Settings\user\Local Settings\Application Data\Identities\{34C6607A-A5A0-417E-8029-5DCD3B5BAEAF}\Microsoft\Outlook Express\Offline.dbx
C:\Documents and Settings\user\Local Settings\History\History.IE5\index.dat
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\config[1].dll
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\gate[1].php
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\webhp[1].txt
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\index.dat
C:\WINDOWS\system32\WBEM\Logs\wbemprox.log
deleted_C:\DOCUME~1\user\LOCALS~1\Temp\nseF.tmp\agitators.dll
deleted_C:\DOCUME~1\user\LOCALS~1\Temp\nslD.tmp\agitators.dll
deleted_C:\DOCUME~1\user\LOCALS~1\Temp\tmp172d10c8.bat
deleted_C:\Documents and Settings\user\Local Settings\Application Data\Google\Chrome\User Data\Default\Pepper Data\Shockwave Flash\WritableRoot\#SharedObjects\DEZBBYAE\macromedia.com\support\flashplayer\sys\settings.sol
deleted_C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\config[1].dll
deleted_C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\gate[1].php
deleted_C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\webhp[1].txt
deleted_C:\sinjector\binary4
network.pcap
newlog.text
processes.txt
processes_final.txt
screenshot-1secs.png
screenshot-40secs.png
screenshot-59secs.png
}}}

== What is each file? ==

  # "*newlog.text*" is the log file generated by the "sinjector_exe" application that runs in the virtual guest system and monitors the API calls of the sample submitted
  # "*network.pcap*" is a .pcap file with the network traffic generated (using "tcpdump") from/to the virtual "host-only" interface ("vboxnet0") used for communications between the guest system and Internet.
  # "*processes.txt*" and "*processes_final.txt*" are two list with the processes that were running before the sample was launched, and after, respectively.
  # "*screenshot-\d+segs.png*" files are image files/screenshots of the desktop, taken while the sample was analyzed at different moments.
  # Files starting with "*deteled*" are files that were deleted by the sample after running.
  # The rest of files were generated by the sample in any moment.

We can look for any copy of the malware in this directory looking by their MD5 hash:

{{{
$ md5 *|grep 353f3b54de9ecfd82c63a2aeaf1c3b9c
MD5 (deleted_C:\sinjector\binary4) = 353f3b54de9ecfd82c63a2aeaf1c3b9c
}}}

"C:\sinjector\binary4" is the name that was chosen by "client.py" for uploading the original sample (not the MD5). Since it's "deleted", it means that the malware deleted himself sometime; probably after running it's main process.

Some files can be easy displayed from the console, for example the generated text files, so you can "grep" or parse them with any tool. There're several tools in the "sinjector_client/scripts" folder to parse those files, also the binaries.

For example, to get the deleted files from "newlog.text" you can run:
{{{
$ ./scripts/deleted_files.py results/353f3b54de9ecfd82c63a2aeaf1c3b9c/newlog.text 
C:\DOCUME~1\user\LOCALS~1\Temp\nseF.tmp|1544
C:\DOCUME~1\user\LOCALS~1\Temp\nseF.tmp\agitators.dll|1544
C:\DOCUME~1\user\LOCALS~1\Temp\nslD.tmp|1408
C:\DOCUME~1\user\LOCALS~1\Temp\nslD.tmp\agitators.dll|1408
C:\DOCUME~1\user\LOCALS~1\Temp\nspC.tmp|1408
C:\DOCUME~1\user\LOCALS~1\Temp\nszE.tmp|1544
C:\DOCUME~1\user\LOCALS~1\Temp\tmp172d10c8.bat|912
C:\Documents and Settings\user\Application Data\Nouc\uwutu.tmp|1152
C:\Documents and Settings\user\Local Settings\Application Data\Google\Chrome\User Data\Default\Pepper Data\Shockwave Flash\WritableRoot\#SharedObjects\DEZBBYAE\macromedia.com\support\flashplayer\sys\settings.sol|152,196
C:\Documents and Settings\user\Local Settings\Application Data\Identities\{34C6607A-A5A0-417E-8029-5DCD3B5BAEAF}\Microsoft\Outlook Express\Sent Items.dbx|152
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\config[1].dll|2300,1152
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\gate[1].php|1152
C:\Documents and Settings\user\Local Settings\Temporary Internet Files\Content.IE5\OLURW1AV\webhp[1].txt|1152
C:\sinjector\binary4|912
}}}

To read the version information of the deleted filed (the submitted one):

{{{
$ ./scripts/pe_fileinfo.py results/353f3b54de9ecfd82c63a2aeaf1c3b9c/deleted_C\:\\sinjector\\binary4 
ProductVersion: 6.00.8.10
FileVersion: 6.00.8.10
ProductName: BCB6 Evaluation Edition
}}}

Get the sections of the binary:

{{{
$ ./scripts/pe_sections.py results/353f3b54de9ecfd82c63a2aeaf1c3b9c/deleted_C\:\\sinjector\\binary4 
('.text\x00\x00\x00', '0x1000', '0x5a68', 23552)
('.rdata\x00\x00', '0x7000', '0x11ce', 4608)
('.data\x00\x00\x00', '0x9000', '0x1a7b8', 1024)
('.ndata\x00\x00', '0x24000', '0x8000', 0)
('.rsrc\x00\x00\x00', '0x2c000', '0xbf8', 3072)
}}}

Display the packets of the ".pcap" file:

{{{
$ python ./scripts/pcap_reader.py results/353f3b54de9ecfd82c63a2aeaf1c3b9c
TCP 192.168.56.201 1060 87.237.198.245 80 357 "87.237.198.245" "/img/config.dll"
TCP 192.168.56.201 1059 87.237.198.245 80 363 "87.237.198.245" "/img/config.dll"
UDP 192.168.56.201 53185 8.8.8.8 53 34 "time.windows.com" ""
UDP 192.168.56.201 55703 8.8.8.8 53 28 "_LDAP._TCP" ""
UDP 192.168.56.201 59082 8.8.8.8 53 32 "www.google.com" ""
TCP 192.168.56.201 1063 216.58.211.228 80 304 "www.google.com" "/webhp"
UDP 192.168.56.201 64754 8.8.8.8 53 31 "www.google.es" ""
TCP 192.168.56.201 1062 87.237.198.245 80 357 "87.237.198.245" "/img/config.dll"
TCP 192.168.56.201 1064 216.58.211.227 80 476 "www.google.es" "/webhp?gfe_rd=cr&ei=xrThVPGwC7Sp8wfRmoKIAg"
TCP 192.168.56.201 1061 87.237.198.245 80 363 "87.237.198.245" "/img/config.dll"
TCP 192.168.56.201 1065 216.58.211.227 443 77 "" ""
TCP 192.168.56.201 1065 216.58.211.227 443 314 "" ""
UDP 192.168.56.201 60802 8.8.8.8 53 34 "crl.geotrust.com" ""
TCP 192.168.56.201 1066 23.54.133.163 80 188 "crl.geotrust.com" "/crls/secureca.crl"
UDP 192.168.56.201 61110 8.8.8.8 53 34 "time.windows.com" ""
UDP 192.168.56.201 60615 8.8.8.8 53 32 "pki.google.com" ""
TCP 192.168.56.201 1067 216.58.211.238 80 178 "pki.google.com" "/GIAG2.crl"
TCP 192.168.56.201 1065 216.58.211.227 443 512 "" ""
UDP 192.168.56.201 61294 8.8.8.8 53 28 "_LDAP._TCP" ""
TCP 192.168.56.201 1062 87.237.198.245 80 609 "87.237.198.245" "/img/gate.php"
UDP 192.168.56.201 137 192.168.56.255 137 50 "" ""
...
}}}